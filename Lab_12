#Вариант 6. Вычислить сумму знакопеременного ряда |х(n-1)|/(n-1)!, где х-матрица ранга к (к и матрица задаются случайным образом), 
# n - номер слагаемого. Сумма считается вычисленной, если точность вычислений будет не меньше t знаков после запятой. 
# У алгоритма д.б. линейная сложность.. Знак первого слагаемого  -.

import random
import numpy as np
from decimal import Decimal

def gen_matrix(): #функция, которая генерирует случайную матрицу
    k = random.randint(2, 5)
    # Генерируем случайную матрицу заданного ранга k
    current_x = np.random.randint(-1, 2, (k, k))
    # Проверяем, чтобы определитель матрицы был ненулевым
    if abs(np.linalg.det(current_x)) == 0:
        return gen_matrix()
    else:
        return current_x
    
def sum(current_x, Orig_x, t): #функция для подсчета суммы ряда |х^(n-1)|/(n-1)!
    n = 1
    factorial = 1
    res = 0

    while True:
        det = np.linalg.det(current_x) # Вычисляем определитель матрицы x
        curr_term = Decimal(det / factorial) # Текущее слагаемое ряда: |x^(n-1)| / (n-1)!

        if abs(curr_term) < 1 / (10 ** t): # Проверка условия завершения цикла по точности
            break

        res += curr_term # Прибавляем текущее слагаемое к результату
        # Обновляем переменные для следующей итерации
        n += 1
        factorial *= n  # Используем n для факториала, так как мы делим на факториал n-1
        
        current_x = np.linalg.matrix_power(Orig_x, n - 1)# Возводим матрицу в степень (n-1) для следующего слагаемого
    return res   
try:
    # Вводим пользовательскую точность
    t = int(input("Введите количество знаков после запятой: "))
    while t < 1:
        t = int(input("Введите число t, большее или равное 1:\n"))
    print()
    # Генерируем матрицу
    Orig_x = gen_matrix()
    current_x = Orig_x

    print("Матрица :")
    print(Orig_x)

    # Вычисляем сумму ряда
    result = sum(current_x,Orig_x, t)

    # Выводим результат с заданной точностью
    print(f"Сумма ряда |х^(n-1)|/(n-1)! с точностью {t} знаков после запятой: {result:.{t}f}")
except ValueError:
    print("Введенный символ не является числом. Перезапустите программу и введите число.")
    exit()


